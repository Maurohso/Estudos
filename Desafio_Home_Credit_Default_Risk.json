{"paragraphs":[{"title":"Modelo Relacional das Tabelas","text":"%pyspark\nprint('Link com modelo relacional das tabelas')\nprint('https://s3.amazonaws.com/treinamento-big-data/imagens/projeto_final_modelo_rel_tabelas.png')","user":"anonymous","dateUpdated":"2019-02-22T23:13:09+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"Link com modelo relacional das tabelas\nhttps://s3.amazonaws.com/treinamento-big-data/imagens/projeto_final_modelo_rel_tabelas.png\n"}]},"apps":[],"jobName":"paragraph_1550875725800_427687077","id":"20181201-205823_81853521","dateCreated":"2019-02-22T22:48:45+0000","dateStarted":"2019-02-22T23:13:09+0000","dateFinished":"2019-02-22T23:13:09+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1664"},{"text":"%pyspark\n","user":"anonymous","dateUpdated":"2019-02-22T22:48:45+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1550875725806_2060472744","id":"20181201-210703_1600580888","dateCreated":"2019-02-22T22:48:45+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:1665"},{"title":"Tabela principal: Applications_train","text":"%pyspark\napplications = spark.read.format(\n   \"com.databricks.spark.csv\").option(\n   \"header\", \"true\").option(\n   \"inferSchema\", \"true\").option(\n   \"delimiter\", ',').load(\n   's3://treinamento-big-data-aws/Dados/desafio_modelagem/application_train.csv')\napplications.count()","user":"anonymous","dateUpdated":"2019-02-22T23:13:15+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"307511\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://ip-172-31-32-198.ec2.internal:4040/jobs/job?id=4","http://ip-172-31-32-198.ec2.internal:4040/jobs/job?id=5","http://ip-172-31-32-198.ec2.internal:4040/jobs/job?id=6"],"interpreterSettingId":"spark"}},"apps":[],"jobName":"paragraph_1550875725807_1595596515","id":"20181201-205333_1922392513","dateCreated":"2019-02-22T22:48:45+0000","dateStarted":"2019-02-22T23:13:15+0000","dateFinished":"2019-02-22T23:13:42+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1666"},{"text":"%pyspark\napplications.printSchema()","user":"anonymous","dateUpdated":"2019-02-22T22:48:45+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"root\n |-- SK_ID_CURR: integer (nullable = true)\n |-- TARGET: integer (nullable = true)\n |-- NAME_CONTRACT_TYPE: string (nullable = true)\n |-- CODE_GENDER: string (nullable = true)\n |-- FLAG_OWN_CAR: string (nullable = true)\n |-- FLAG_OWN_REALTY: string (nullable = true)\n |-- CNT_CHILDREN: integer (nullable = true)\n |-- AMT_INCOME_TOTAL: double (nullable = true)\n |-- AMT_CREDIT: double (nullable = true)\n |-- AMT_ANNUITY: double (nullable = true)\n |-- AMT_GOODS_PRICE: double (nullable = true)\n |-- NAME_TYPE_SUITE: string (nullable = true)\n |-- NAME_INCOME_TYPE: string (nullable = true)\n |-- NAME_EDUCATION_TYPE: string (nullable = true)\n |-- NAME_FAMILY_STATUS: string (nullable = true)\n |-- NAME_HOUSING_TYPE: string (nullable = true)\n |-- REGION_POPULATION_RELATIVE: double (nullable = true)\n |-- DAYS_BIRTH: integer (nullable = true)\n |-- DAYS_EMPLOYED: integer (nullable = true)\n |-- DAYS_REGISTRATION: double (nullable = true)\n |-- DAYS_ID_PUBLISH: integer (nullable = true)\n |-- OWN_CAR_AGE: double (nullable = true)\n |-- FLAG_MOBIL: integer (nullable = true)\n |-- FLAG_EMP_PHONE: integer (nullable = true)\n |-- FLAG_WORK_PHONE: integer (nullable = true)\n |-- FLAG_CONT_MOBILE: integer (nullable = true)\n |-- FLAG_PHONE: integer (nullable = true)\n |-- FLAG_EMAIL: integer (nullable = true)\n |-- OCCUPATION_TYPE: string (nullable = true)\n |-- CNT_FAM_MEMBERS: double (nullable = true)\n |-- REGION_RATING_CLIENT: integer (nullable = true)\n |-- REGION_RATING_CLIENT_W_CITY: integer (nullable = true)\n |-- WEEKDAY_APPR_PROCESS_START: string (nullable = true)\n |-- HOUR_APPR_PROCESS_START: integer (nullable = true)\n |-- REG_REGION_NOT_LIVE_REGION: integer (nullable = true)\n |-- REG_REGION_NOT_WORK_REGION: integer (nullable = true)\n |-- LIVE_REGION_NOT_WORK_REGION: integer (nullable = true)\n |-- REG_CITY_NOT_LIVE_CITY: integer (nullable = true)\n |-- REG_CITY_NOT_WORK_CITY: integer (nullable = true)\n |-- LIVE_CITY_NOT_WORK_CITY: integer (nullable = true)\n |-- ORGANIZATION_TYPE: string (nullable = true)\n |-- EXT_SOURCE_1: double (nullable = true)\n |-- EXT_SOURCE_2: double (nullable = true)\n |-- EXT_SOURCE_3: double (nullable = true)\n |-- APARTMENTS_AVG: double (nullable = true)\n |-- BASEMENTAREA_AVG: double (nullable = true)\n |-- YEARS_BEGINEXPLUATATION_AVG: double (nullable = true)\n |-- YEARS_BUILD_AVG: double (nullable = true)\n |-- COMMONAREA_AVG: double (nullable = true)\n |-- ELEVATORS_AVG: double (nullable = true)\n |-- ENTRANCES_AVG: double (nullable = true)\n |-- FLOORSMAX_AVG: double (nullable = true)\n |-- FLOORSMIN_AVG: double (nullable = true)\n |-- LANDAREA_AVG: double (nullable = true)\n |-- LIVINGAPARTMENTS_AVG: double (nullable = true)\n |-- LIVINGAREA_AVG: double (nullable = true)\n |-- NONLIVINGAPARTMENTS_AVG: double (nullable = true)\n |-- NONLIVINGAREA_AVG: double (nullable = true)\n |-- APARTMENTS_MODE: double (nullable = true)\n |-- BASEMENTAREA_MODE: double (nullable = true)\n |-- YEARS_BEGINEXPLUATATION_MODE: double (nullable = true)\n |-- YEARS_BUILD_MODE: double (nullable = true)\n |-- COMMONAREA_MODE: double (nullable = true)\n |-- ELEVATORS_MODE: double (nullable = true)\n |-- ENTRANCES_MODE: double (nullable = true)\n |-- FLOORSMAX_MODE: double (nullable = true)\n |-- FLOORSMIN_MODE: double (nullable = true)\n |-- LANDAREA_MODE: double (nullable = true)\n |-- LIVINGAPARTMENTS_MODE: double (nullable = true)\n |-- LIVINGAREA_MODE: double (nullable = true)\n |-- NONLIVINGAPARTMENTS_MODE: double (nullable = true)\n |-- NONLIVINGAREA_MODE: double (nullable = true)\n |-- APARTMENTS_MEDI: double (nullable = true)\n |-- BASEMENTAREA_MEDI: double (nullable = true)\n |-- YEARS_BEGINEXPLUATATION_MEDI: double (nullable = true)\n |-- YEARS_BUILD_MEDI: double (nullable = true)\n |-- COMMONAREA_MEDI: double (nullable = true)\n |-- ELEVATORS_MEDI: double (nullable = true)\n |-- ENTRANCES_MEDI: double (nullable = true)\n |-- FLOORSMAX_MEDI: double (nullable = true)\n |-- FLOORSMIN_MEDI: double (nullable = true)\n |-- LANDAREA_MEDI: double (nullable = true)\n |-- LIVINGAPARTMENTS_MEDI: double (nullable = true)\n |-- LIVINGAREA_MEDI: double (nullable = true)\n |-- NONLIVINGAPARTMENTS_MEDI: double (nullable = true)\n |-- NONLIVINGAREA_MEDI: double (nullable = true)\n |-- FONDKAPREMONT_MODE: string (nullable = true)\n |-- HOUSETYPE_MODE: string (nullable = true)\n |-- TOTALAREA_MODE: double (nullable = true)\n |-- WALLSMATERIAL_MODE: string (nullable = true)\n |-- EMERGENCYSTATE_MODE: string (nullable = true)\n |-- OBS_30_CNT_SOCIAL_CIRCLE: double (nullable = true)\n |-- DEF_30_CNT_SOCIAL_CIRCLE: double (nullable = true)\n |-- OBS_60_CNT_SOCIAL_CIRCLE: double (nullable = true)\n |-- DEF_60_CNT_SOCIAL_CIRCLE: double (nullable = true)\n |-- DAYS_LAST_PHONE_CHANGE: double (nullable = true)\n |-- FLAG_DOCUMENT_2: integer (nullable = true)\n |-- FLAG_DOCUMENT_3: integer (nullable = true)\n |-- FLAG_DOCUMENT_4: integer (nullable = true)\n |-- FLAG_DOCUMENT_5: integer (nullable = true)\n |-- FLAG_DOCUMENT_6: integer (nullable = true)\n |-- FLAG_DOCUMENT_7: integer (nullable = true)\n |-- FLAG_DOCUMENT_8: integer (nullable = true)\n |-- FLAG_DOCUMENT_9: integer (nullable = true)\n |-- FLAG_DOCUMENT_10: integer (nullable = true)\n |-- FLAG_DOCUMENT_11: integer (nullable = true)\n |-- FLAG_DOCUMENT_12: integer (nullable = true)\n |-- FLAG_DOCUMENT_13: integer (nullable = true)\n |-- FLAG_DOCUMENT_14: integer (nullable = true)\n |-- FLAG_DOCUMENT_15: integer (nullable = true)\n |-- FLAG_DOCUMENT_16: integer (nullable = true)\n |-- FLAG_DOCUMENT_17: integer (nullable = true)\n |-- FLAG_DOCUMENT_18: integer (nullable = true)\n |-- FLAG_DOCUMENT_19: integer (nullable = true)\n |-- FLAG_DOCUMENT_20: integer (nullable = true)\n |-- FLAG_DOCUMENT_21: integer (nullable = true)\n |-- AMT_REQ_CREDIT_BUREAU_HOUR: double (nullable = true)\n |-- AMT_REQ_CREDIT_BUREAU_DAY: double (nullable = true)\n |-- AMT_REQ_CREDIT_BUREAU_WEEK: double (nullable = true)\n |-- AMT_REQ_CREDIT_BUREAU_MON: double (nullable = true)\n |-- AMT_REQ_CREDIT_BUREAU_QRT: double (nullable = true)\n |-- AMT_REQ_CREDIT_BUREAU_YEAR: double (nullable = true)\n\n"}]},"apps":[],"jobName":"paragraph_1550875725807_-766949728","id":"20181201-210214_2063944110","dateCreated":"2019-02-22T22:48:45+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:1667"},{"text":"%pyspark\napplications_sql = applications.registerTempTable(\"applications_sql\")\nMauro001=spark.sql(\n             \"\"\"SELECT \n                    SK_ID_CURR,\n                    NAME_CONTRACT_TYPE,\n                    CODE_GENDER,\n                    AMT_CREDIT,\n                    TARGET,\n                    NAME_HOUSING_TYPE,\n                    OCCUPATION_TYPE,\n                    REG_REGION_NOT_LIVE_REGION,\n                    REG_REGION_NOT_WORK_REGION,\n                    REG_CITY_NOT_LIVE_CITY,\n                    REG_CITY_NOT_WORK_CITY,\n                    FLOORSMAX_AVG,\n                    LANDAREA_MODE,\n                    YEARS_BUILD_MEDI,\n                    TOTALAREA_MODE\n                FROM\n                    applications_sql \n         \"\"\"\n         )","user":"anonymous","dateUpdated":"2019-02-22T23:26:26+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1550875725808_503307246","id":"20181201-210126_1630984863","dateCreated":"2019-02-22T22:48:45+0000","dateStarted":"2019-02-22T23:26:26+0000","dateFinished":"2019-02-22T23:26:26+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1668"},{"title":"Salvando ABT para modelar no Jupyter","text":"%pyspark\n#applications.repartition(1).write.save(\"s3://treinamento-big-data/dados_desafio/abt_v01_aluno_n.csv\", format='csv', header=True)\n\n#applications.write.format(\"com.databricks.spark.parquet\").option(\"header\", \"true\").save(\"s3://treinamento-big-data/dados_desafio/abt_v01_aluno_n\")\n\n#applications.write.partitionBy(\"id\", \"key\").parquet(\"/path/to/file\")\n\nMauro001.write.parquet(\"s3://treinamento-big-data-aws/Alunos/Turma_20190218/desafio/abt_v01_aluno_Mauro\",mode=\"overwrite\")","user":"anonymous","dateUpdated":"2019-02-22T23:26:34+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://ip-172-31-32-198.ec2.internal:4040/jobs/job?id=8"],"interpreterSettingId":"spark"}},"apps":[],"jobName":"paragraph_1550875725809_1618240357","id":"20181201-212057_287846865","dateCreated":"2019-02-22T22:48:45+0000","dateStarted":"2019-02-22T23:26:34+0000","dateFinished":"2019-02-22T23:26:50+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1669"},{"text":"%pyspark\nbureau = spark.read.format(\n   \"com.databricks.spark.csv\").option(\n   \"header\", \"true\").option(\n   \"inferSchema\", \"true\").option(\n   \"delimiter\", ',').load(\n   's3://treinamento-big-data/dados_desafio/bureau.csv')\nbureau.count()","user":"anonymous","dateUpdated":"2019-02-22T22:48:45+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"1716428\n"}]},"apps":[],"jobName":"paragraph_1550875725809_1962814179","id":"20181201-210344_1577852211","dateCreated":"2019-02-22T22:48:45+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:1670"},{"text":"%pyspark\nbureau.printSchema()","user":"anonymous","dateUpdated":"2019-02-22T22:48:45+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"root\n |-- SK_ID_CURR: integer (nullable = true)\n |-- SK_ID_BUREAU: integer (nullable = true)\n |-- CREDIT_ACTIVE: string (nullable = true)\n |-- CREDIT_CURRENCY: string (nullable = true)\n |-- DAYS_CREDIT: integer (nullable = true)\n |-- CREDIT_DAY_OVERDUE: integer (nullable = true)\n |-- DAYS_CREDIT_ENDDATE: double (nullable = true)\n |-- DAYS_ENDDATE_FACT: double (nullable = true)\n |-- AMT_CREDIT_MAX_OVERDUE: double (nullable = true)\n |-- CNT_CREDIT_PROLONG: integer (nullable = true)\n |-- AMT_CREDIT_SUM: double (nullable = true)\n |-- AMT_CREDIT_SUM_DEBT: double (nullable = true)\n |-- AMT_CREDIT_SUM_LIMIT: double (nullable = true)\n |-- AMT_CREDIT_SUM_OVERDUE: double (nullable = true)\n |-- CREDIT_TYPE: string (nullable = true)\n |-- DAYS_CREDIT_UPDATE: integer (nullable = true)\n |-- AMT_ANNUITY: double (nullable = true)\n\n"}]},"apps":[],"jobName":"paragraph_1550875725809_1137663117","id":"20181201-210814_1619202631","dateCreated":"2019-02-22T22:48:45+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:1671"},{"text":"%pyspark\nbureau.show(10)","user":"anonymous","dateUpdated":"2019-02-22T22:48:45+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+----------+------------+-------------+---------------+-----------+------------------+-------------------+-----------------+----------------------+------------------+--------------+-------------------+--------------------+----------------------+---------------+------------------+-----------+\n|SK_ID_CURR|SK_ID_BUREAU|CREDIT_ACTIVE|CREDIT_CURRENCY|DAYS_CREDIT|CREDIT_DAY_OVERDUE|DAYS_CREDIT_ENDDATE|DAYS_ENDDATE_FACT|AMT_CREDIT_MAX_OVERDUE|CNT_CREDIT_PROLONG|AMT_CREDIT_SUM|AMT_CREDIT_SUM_DEBT|AMT_CREDIT_SUM_LIMIT|AMT_CREDIT_SUM_OVERDUE|    CREDIT_TYPE|DAYS_CREDIT_UPDATE|AMT_ANNUITY|\n+----------+------------+-------------+---------------+-----------+------------------+-------------------+-----------------+----------------------+------------------+--------------+-------------------+--------------------+----------------------+---------------+------------------+-----------+\n|    215354|     5714462|       Closed|     currency 1|       -497|                 0|             -153.0|           -153.0|                  null|                 0|       91323.0|                0.0|                null|                   0.0|Consumer credit|              -131|       null|\n|    215354|     5714463|       Active|     currency 1|       -208|                 0|             1075.0|             null|                  null|                 0|      225000.0|           171342.0|                null|                   0.0|    Credit card|               -20|       null|\n|    215354|     5714464|       Active|     currency 1|       -203|                 0|              528.0|             null|                  null|                 0|      464323.5|               null|                null|                   0.0|Consumer credit|               -16|       null|\n|    215354|     5714465|       Active|     currency 1|       -203|                 0|               null|             null|                  null|                 0|       90000.0|               null|                null|                   0.0|    Credit card|               -16|       null|\n|    215354|     5714466|       Active|     currency 1|       -629|                 0|             1197.0|             null|               77674.5|                 0|     2700000.0|               null|                null|                   0.0|Consumer credit|               -21|       null|\n|    215354|     5714467|       Active|     currency 1|       -273|                 0|            27460.0|             null|                   0.0|                 0|      180000.0|           71017.38|           108982.62|                   0.0|    Credit card|               -31|       null|\n|    215354|     5714468|       Active|     currency 1|        -43|                 0|               79.0|             null|                   0.0|                 0|       42103.8|            42103.8|                 0.0|                   0.0|Consumer credit|               -22|       null|\n|    162297|     5714469|       Closed|     currency 1|      -1896|                 0|            -1684.0|          -1710.0|               14985.0|                 0|      76878.45|                0.0|                 0.0|                   0.0|Consumer credit|             -1710|       null|\n|    162297|     5714470|       Closed|     currency 1|      -1146|                 0|             -811.0|           -840.0|                   0.0|                 0|      103007.7|                0.0|                 0.0|                   0.0|Consumer credit|              -840|       null|\n|    162297|     5714471|       Active|     currency 1|      -1146|                 0|             -484.0|             null|                   0.0|                 0|        4500.0|                0.0|                 0.0|                   0.0|    Credit card|              -690|       null|\n+----------+------------+-------------+---------------+-----------+------------------+-------------------+-----------------+----------------------+------------------+--------------+-------------------+--------------------+----------------------+---------------+------------------+-----------+\nonly showing top 10 rows\n\n"}]},"apps":[],"jobName":"paragraph_1550875725810_783851460","id":"20181201-210814_1106469083","dateCreated":"2019-02-22T22:48:45+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:1672"},{"text":"%pyspark\n","user":"anonymous","dateUpdated":"2019-02-22T22:48:45+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1550875725810_568183224","id":"20181201-211004_815671305","dateCreated":"2019-02-22T22:48:45+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:1673"}],"name":"Desafio_Home_Credit_Default_Risk","id":"2E3XCARN3","noteParams":{},"noteForms":{},"angularObjects":{"spark:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}